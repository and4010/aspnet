CREATE FUNCTION InboundFlatPickingList (@SHIPMENT_NUMBER NVARCHAR(30))
RETURNS TABLE
AS
RETURN
(
SELECT
ROW_NUMBER() OVER(ORDER BY h.TRANSFER_HEADER_ID) AS SUB_ID,
h.SHIPMENT_NUMBER AS SHIPMENT_NUMBER,
h.ORGANIZATION_CODE AS ORGANIZATION_CODE,
h.SUBINVENTORY_CODE AS SUBINVENTORY_CODE,
h.LOCATOR_CODE AS LOCATOR_CODE,
h.TRANSFER_ORGANIZATION_CODE AS TRANSFER_ORGANIZATION_CODE,
h.TRANSFER_SUBINVENTORY_CODE AS TRANSFER_SUBINVENTORY_CODE,
h.TRANSFER_LOCATOR_CODE AS TRANSFER_LOCATOR_CODE,
i.CATALOG_ELEM_VAL_020 AS PAPER_TYPE,
i.CATALOG_ELEM_VAL_040 AS BASIC_WEIGHT,
i.CATALOG_ELEM_VAL_050 AS SPECIFICATION,
i.CATALOG_ELEM_VAL_100 AS GRAIN_DIRECTION,
d.PACKING_TYPE AS PACKING_TYPE,
d.ROLL_REAM_WT AS ROLL_REAM_WT,
p.LOT_NUMBER AS LOT_NUMBER,
p.SECONDARY_QUANTITY AS SECONDARY_QUANTITY,
p.SECONDARY_UOM AS SECONDARY_UOM,
p.PRIMARY_QUANTITY AS PRIMARY_QUANTITY,
p.PRIMARY_UOM AS PRIMARY_UOM
FROM TRF_HEADER_T h
INNER JOIN TRF_DETAIL_T d on h.TRANSFER_HEADER_ID = d.TRANSFER_HEADER_ID
INNER JOIN TRF_INBOUND_PICKED_T p on p.TRANSFER_HEADER_ID = d.TRANSFER_HEADER_ID AND p.TRANSFER_DETAIL_ID = d.TRANSFER_DETAIL_ID
join ORG_ITEMS_T o on h.ORGANIZATION_ID = o.ORGANIZATION_ID
join ITEMS_T i on o.INVENTORY_ITEM_ID = i.INVENTORY_ITEM_ID AND d.INVENTORY_ITEM_ID = i.INVENTORY_ITEM_ID AND i.CONTROL_FLAG <> 'D'
WHERE d.ITEM_CATEGORY = '平版' AND h.SHIPMENT_NUMBER = @SHIPMENT_NUMBER
);
GO